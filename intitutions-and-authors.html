<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link rel="stylesheet" href="styles/settings.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/generic.css">
    <link rel="stylesheet" href="styles/objects.css">
    <link rel="stylesheet" href="styles/components.css">

    <title>Trabalho de InfoViz</title>
    <style>
      .marker {
        fill: #31558d;
        fill-opacity: .75;
        transition: all .2s ease-in-out;
      }
    </style>
  </head>
  <body>
    <header>
      <div class="header__top">
        <div class="header__logo">
          <h3 class="header__title">HInt within the HCI scope - Definition, State-of-the-Art and Challenges</h3>
          <p class="header__subtitle">A Visual Survey of Human-Computer Integration (HInt) in the HCI view point</p>
          <p class="header__authors">By Glívia A. R. Barbosa, Elizabeth D. S. da Costa, Felipe S. A. de Freitas and Eduardo H. R. da Silva</p>
        </div>
        <div class="header__left-side">
          <ul class="header__left-side__menu">
            <li class="header__left-side__menu__item">
              <a href="/">Home</a>
            </li>
            <li class="header__left-side__menu__item header__left-side__menu__item--active">
              <a href="/intitutions-and-authors.html">Publications</a>
            </li>
            <li class="header__left-side__menu__item">
              <a href="/challenges.html">HInt Challenges</a>
            </li>
          </ul>
        </div>
      </div>
      <div class="header__submenu">
        <ul class="header__submenu__list">
          <li class="header__submenu__list__item header__submenu__list__item--active">
            <a href="/intitutions-and-authors.html">Institutions and Authors</a>
          </li>
          <li class="header__submenu__list__item">
            <a href="/collaboration-networks.html">Collaboration Network</a>
          </li>
          <li class="header__submenu__list__item">
            <a href="/focus-contributions.html">Focus</a>
          </li>
          <li class="header__submenu__list__item">
            <a href="/contribution-types.html">Contribution Types</a>
          </li>
          <li class="header__submenu__list__item">
            <a href="/reference-list.html">References</a>
          </li>
        </ul>
      </div>
    </header>
    <main>
      <div class="container">
        <section class="stats">
          <div class="stats__stat stats__stat--light-cornflower-blue tooltip" data-tooltip="A Survey of Incorporating Affective Computing for Human-System Co-adaptation&#013;&#010;Augmented Human and Human-Machine Co-evolution: Efficiency and Ethics&#013;&#010;Beyond Confluence, Integration and Symbiosis: Creating More Aware Relationships in Smart Cities&#013;&#010;Body-Borne Computers as Extensions of Self&#013;&#010;Co-riding With My eBike to Get Green Lights&#013;&#010;Computer as Partner: A Critique Perspective of Interaction Design for Social Sustainability&#013;&#010;Designing human-in-the-loop autonomous Cyber-Physical Systems&#013;&#010;Embracing Companion Technologies&#013;&#010;Engineering human-in-the-loop interactions in cyber-physical systems&#013;&#010;Human augmentation: Past, present and future&#013;&#010;Human-computer integration&#013;&#010;Human-Computer Integration (Dagstuhl Seminar 18322)&#013;&#010;Human-Engaged Computing: the future of Human–Computer Interaction&#013;&#010;'I had super-powers when eBike riding' Towards Understanding the Design of Integrated Exertion&#013;&#010;Introducing Peripheral Awareness as a Neurological State for Human-computer Integration&#013;&#010;Manifesting the Cyborg through Techno-Body Modification: From Human-Computer Interaction to Integration&#013;&#010;Next Steps for Human-Computer Integration&#013;&#010;Seven HCI Grand Challenges&#013;&#010;The future's hybrid nature&#013;&#010;The Guts Game: Towards Designing Ingestible Games">
            <div class="stats__stat__title">SLR Analyzed Publications</div>
            <div class="stats__stat__value">
              <span class="stats__stat__value__numeric">20</span>
            </div>
          </div>
          <div class="stats__stat stats__stat--light-blue tooltip" data-tooltip="Australia&#013;&#010;Austria&#013;&#010;Canada&#013;&#010;China&#013;&#010;Cyprus&#013;&#010;Denmark&#013;&#010;Finland&#013;&#010;France&#013;&#010;Germany&#013;&#010;Greece&#013;&#010;Japan&#013;&#010;Netherlands&#013;&#010;New Zealand&#013;&#010;Spain&#013;&#010;United Kingdom (UK)&#013;&#010;United States of America (USA)">
            <div class="stats__stat__title">Countries exploring HInt</div>
            <div class="stats__stat__value">
              <span class="stats__stat__value__numeric">16</span>
              <span class="stats__stat__value__description">16 (8.2%) of 195 countries in the world</span>
            </div>
          </div>
          <div class="stats__stat stats__stat--light-purple-3">
            <div class="stats__stat__title">Institutions exploring HInt around the world</div>
            <div class="stats__stat__value home__body__stats__stat__slr__total__description">
              <span class="stats__stat__value__numeric">70</span>
            </div>
          </div>
          <div class="stats__stat stats__stat--light-magenta-3">
            <div class="stats__stat__title">Authors exploring HInt around the world</div>
            <div class="stats__stat__value">
              <span class="stats__stat__value__numeric">100</span>
            </div>
          </div>
        </section>
  
        <section class="card">
          <div class="card__header">
            <h2>Countries, institutions and authors who are addressing the Human-Computer Interaction (HInt) <span class="icon-with-label icon-information-label" data-title="The listed institutions correspond to the institutions in which the authors were associated at the time the publication analyzed in this SLR was published"></span></h2>
          </div>
          <div class="card__body">
            <div class="card__body__countries">
              <div class="card__body__countries__group">
                <div class="card__body__countries__legends">
                  <div class="card__body__countries__legends__legend">
                    <div class="card__body__countries__legends__legend__sign">
                      <span class="card__body__countries__legends__legend__sign--light-purple"></span>
                    </div>
                    <div class="card__body__countries__legends__legend__description">
                      Country with at least one author and institution exploring the HInt
                    </div>
                  </div>
                </div>
                <div class="card__body__countries__map"></div>
                <div class="card__body__countries__explains">
                  <p>* A same publication may have been published by authors from different countries and institutions</p>
                </div>
              </div>
              <div class="card__body__countries__details">
                <div class="card__body__countries__details__header"></div>
                <div class="card__body__countries__details__body">
                  <div class="card__body__countries__details__click-to-display-info">
                    <p><span class="icon icon-information"></span> To see the institutions and authors list of a country, click on the desired country in the map</p>
                  </div>
                  <div class="card__body__countries__details__institutions">
                    <div class="card__body__countries__details__institutions__title"></div>
                    <ul class="card__body__countries__details__institutions__list"></ul>
                  </div>
                  <div class="card__body__countries__details__authors">
                    <div class="card__body__countries__details__authors__title"></div>
                    <ul class="card__body__countries__details__authors__list"></ul>
                  </div>
                </div>
              </div>
              <div class="card__body__countries__tooltip"></div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <script>
      const width = '500'
      const height = '300'

      const svg = d3.select('.card__body__countries__map')
        .append('svg')
        .attr("viewBox", `0 0 ${width} ${height}`)
      
      const projection = d3
        .geoNaturalEarth1()
        .scale(width / 1.6 / Math.PI)
        .translate([width / 2, height / 2])
      
      const geoPath = d3.geoPath()
        .projection(projection)
      
      d3.json('./data/countries-institutions-authors.json').then(function (institutionsAuthorsList) {
        d3.json('./data/countries.json').then(function (mapFeatures) {
          const g = svg.append('g')
            .selectAll('path')
            .data(mapFeatures.features)
            .join('path')
            .attr('d', geoPath)
            .attr('data-selected', false)
            .attr('class', getCountryHighlightedClass)
            .on('mouseover', showTooltip(institutionsAuthorsList))
            .on('mouseout', hideTooltip)
            .on('click', onCountryClick(institutionsAuthorsList))

            svg.append("g")
              .selectAll("g")
              .data(mapFeatures.features)
              .enter()                
              .append("circle")
              .attr('r', 1)
              .attr("transform", d => `translate(${geoPath.centroid(d)})`)
              .attr('class', getCountryPinHighlightedClass)
              .on('mouseover', showTooltip(institutionsAuthorsList))
              .on('mouseout', hideTooltip)
              .on('click', onCountryClick(institutionsAuthorsList))
        })
      })

      function sortBy(attributeName) {
        return function (a, b) {
          if (a[attributeName] > b[attributeName]) return 1
          if (a[attributeName] < b[attributeName]) return -1
          return 0
        }
      }

      function reduceArrayToObjectByKeyValue(key, attributeName) {
        return (previousValue, currentValue, currentIndex, array) => {
          if (previousValue[currentValue[key]])
            previousValue[currentValue[key]] = [...previousValue[currentValue[key]], currentValue[attributeName]]
          else
            previousValue[currentValue[key]] = [currentValue[attributeName]]
          return previousValue
        }
      }

      function filterBy(key, value) {
        return function (currentValue) {
          if (currentValue[key] === value) {
            return currentValue
          }
        }
      }

      function buildCountryTooltipHtml(hasArticles, countryId, countryName, institutionsTotal, authorsTotal) {
        return `
          <div class="country-title">
            ${hasArticles ? `<span class="flag ${countryId}-flag"></span>` : ``}
            <span class="country-title__name"><strong>${countryName}</strong></span>
          </div>
          <div class="country-academic-info">
            <span>Total of institutions: ${(institutionsTotal ? institutionsTotal : 0)}</span>
            <span>Total of authors: ${(authorsTotal ? authorsTotal : 0)}</span>
          </div>
        `
      }

      function buildCountryDetailsHeaderHtml(countryId, countryName, articlesNumber) {
        return `
          <span class="card__body__countries__details__header__flag ${countryId}-flag"></span>
          <span class="card__body__countries__details__header__title">
            <strong>Country:</strong> ${countryName} (${countryId}) -&nbsp;<span class="card__body__countries__details__header__title__highlight">Total of Publications*: ${articlesNumber}</span>&nbsp;of 20
          </span>
        `
      }

      function getCountryClassOnHover(isCountrySelected, hasArticles) {
        if (isCountrySelected === 'false') {
          if (hasArticles)
            return 'country hover'
          else 
            return 'country'
        } else {
          if (hasArticles)
            return 'country hover'
          else 
            return 'country'
        }
      }
      
      function getCountryHighlightedClass(svgElement) {
        if (svgElement.properties.articles > 0)
          return 'country country-highlighted'
        else 
          return 'country'
      }

      function getCountryPinHighlightedClass(svgElement) {
        if (svgElement.properties.articles > 0)
          return 'country-pin country-highlighted-pin'
        else 
          return 'country-pin'
      }

      function showTooltip (institutionsAuthorsList) {
        return (event, data) => {
          if (data.properties.articles > 0) {
            const institutionsByCountry = institutionsAuthorsList.filter(filterBy('code', data.id))
            const institutionsTotal = Object.keys(institutionsByCountry.reduce(reduceArrayToObjectByKeyValue('institution', 'author'), {})).length
            const authorsTotal = Object.keys(institutionsByCountry.reduce(reduceArrayToObjectByKeyValue('author', 'institution'), {})).length
            d3.select(event.target).attr('class', 'country hover')
            d3.select('.card__body__countries__tooltip')
              .style('visibility','visible')
              .style('top', event.layerY + 10 + 'px')
              .style('left', event.layerX + 10 + 'px')
              .html(buildCountryTooltipHtml(data.properties.articles > 0, data.id, data.properties.name, institutionsTotal, authorsTotal))
          }
        }
      }

      function hideTooltip(event) {
        const countryTarget = event.target
        if (countryTarget.dataset.selected === 'false') {
          d3.select(this).attr('class', getCountryHighlightedClass)
        }
        d3.select('.card__body__countries__tooltip')
          .style('visibility','hidden')
      }

      function highlightAuthorsFromInstitutions(event) {
        const authorsLi = document.querySelectorAll('.card__body__countries__details__authors__list li')
        authorsLi.forEach(authorLi => {
          const authors = event.target.getAttribute('data-authors').split(',')
          if (authors.includes(authorLi.innerHTML))
            authorLi.classList.toggle('card__body__countries__details__authors__list--highlighted')
        });
      }

      function highlightInstitutionsFromAuthors(event) {
        const institutionsLi = document.querySelectorAll('.card__body__countries__details__institutions__list li')
        institutionsLi.forEach(institutionLi => {
          const institutions = event.target.getAttribute('data-institution').split(',')
          if (institutions.includes(institutionLi.innerHTML))
            institutionLi.classList.toggle('card__body__countries__details__institutions__list--highlighted')
        });
      }

      function onCountryClick(institutionsAuthorsList) {
        return function (event, svgElement) {
          if (svgElement.properties.articles > 0) {
            const countryTarget = event.target
            d3.selectAll('[data-selected=true]')
              .attr('data-selected', false)
              .attr('class', 'country-pin country-highlighted-pin')
            d3.select(this).attr('data-selected', true)
            d3.select(this).attr('class', getCountryClassOnHover(countryTarget.dataset.selected, svgElement.properties.articles > 0))
  
            const countrySelected = svgElement
            const institutionAuthorsByCountry = institutionsAuthorsList.filter(filterBy('code', countrySelected.id))
            const institutions = institutionAuthorsByCountry
              .sort(sortBy('institution'))
              .reduce(reduceArrayToObjectByKeyValue('institution', 'author'), {})
  
            const authors = institutionAuthorsByCountry
              .sort(sortBy('author'))
              .reduce(reduceArrayToObjectByKeyValue('author', 'institution'), {})
  
            const detailsMessageElement = document.querySelector('.card__body__countries__details__click-to-display-info')
            detailsMessageElement.classList.add('card__body__countries__details__click-to-display-info--hidden')
            d3.select('.card__body__countries__details__header')
              .html(buildCountryDetailsHeaderHtml(countrySelected.id, countrySelected.properties.name, svgElement.properties.articles))
            d3.select('.card__body__countries__details__institutions__title')
              .html(`
                <span><strong>Institutions - Total: ${Object.keys(institutions).length}</strong> of 70</span>
              `)
            d3.select('.card__body__countries__details__institutions__list')
              .selectAll('li')
              .data(Object.entries(institutions))
              .join('li')
              .attr('data-authors', authorInstitution => authorInstitution[1])
              .text(authorInstitution => authorInstitution[0])
              .on('mouseover', highlightAuthorsFromInstitutions)
              .on('mouseout', highlightAuthorsFromInstitutions)
            d3.select('.card__body__countries__details__authors__title')
              .html(`
                <span><strong>Authors - Total: ${Object.keys(authors).length}</strong> of 100</span>
              `)
            d3.select('.card__body__countries__details__authors__list')
              .selectAll('li')
              .data(Object.entries(authors))
              .join('li')
              .attr('data-institution', authorInstitution => authorInstitution[1])
              .text(authorInstitution => authorInstitution[0])
              .on('mouseover', highlightInstitutionsFromAuthors)
              .on('mouseout', highlightInstitutionsFromAuthors)
              const institutionsDetailsDiv = document.querySelector('.card__body__countries__details__institutions')
              institutionsDetailsDiv.classList.add('card__body__countries__details__institutions--active')
          }
        }   
      }
    </script>
  </body>
</html>
